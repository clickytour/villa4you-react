<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Concept 1 Refined ‚Äî Proposal Collection</title>
  <style>
    :root {
      --bg: #f6f7fb;
      --card: #fff;
      --text: #1f2430;
      --muted: #6f7787;
      --line: #e6e8ef;
      --brand: #ff6b2c;
    }
    * { box-sizing: border-box; }
    body { margin:0; font-family: Inter, Segoe UI, Arial, sans-serif; background:var(--bg); color:var(--text); }

    .toolbar {
      position: sticky; top:0; z-index: 5;
      background:#0f1420; color:#fff; padding:12px 14px;
      display:flex; gap:12px; flex-wrap:wrap; align-items:center;
    }
    .toolbar select { padding:7px 8px; border-radius:8px; border:1px solid #2c3448; background:#161d2d; color:#fff; }
    .toolbar .hint { color:#b9c1d4; font-size:12px; }

    .app { max-width:980px; margin:18px auto; padding:0 14px 24px; }
    .shell { border:1px solid var(--line); border-radius:16px; overflow:hidden; background:#fff; }
    .top {
      display:flex; justify-content:space-between; align-items:flex-start; gap:10px;
      border-bottom:1px solid var(--line); padding:14px 16px;
      background:linear-gradient(180deg,#fff,#fcfdff);
    }
    .logo { font-weight:800; letter-spacing:.2px; }
    .logo span { color:var(--brand); }
    .wl .logo { display:none; }
    .muted { color:var(--muted); font-size:13px; }
    .badge { font-size:12px; padding:4px 8px; border:1px solid #ffd9ca; background:#fff3ee; color:#8f2e00; border-radius:999px; }

    .content { padding:14px; }
    .collection-hero {
      border:1px solid var(--line); border-radius:12px; background:#fbfcff; padding:12px; margin-bottom:12px;
    }
    .trust-strip { border:1px solid var(--line); border-radius:12px; background:#fff; padding:10px; margin-bottom:12px; display:flex; flex-wrap:wrap; gap:8px; }
    .bundle {
      border:1px solid var(--line); border-radius:12px; background:#fff; padding:12px; margin-bottom:12px;
    }
    .bundle h4 { margin:0; font-size:18px; }
    .bundle-grid { margin-top:10px; display:grid; gap:8px; grid-template-columns:repeat(3,minmax(0,1fr)); }
    .bundle-item { border:1px solid var(--line); border-radius:10px; padding:8px; background:#fcfdff; }
    .collection-hero h3 { margin:0 0 6px; font-size:18px; }
    .pill-row { display:flex; flex-wrap:wrap; gap:8px; margin-top:8px; }
    .pill { font-size:12px; border:1px solid var(--line); border-radius:999px; padding:4px 8px; background:#fff; }

    .stack { display:grid; gap:12px; grid-template-columns:repeat(3,minmax(0,1fr)); }
    .card { border:1px solid var(--line); border-radius:12px; background:var(--card); overflow:hidden; display:flex; flex-direction:column; }
    .feedback-row { display:flex; justify-content:space-between; align-items:center; gap:8px; padding:10px; border-bottom:1px solid var(--line); }
    .feedback-row .label { font-size:12px; color:var(--muted); }
    .feedback-actions { display:flex; gap:8px; }
    .proposal-feedback { border:1px solid var(--line); border-radius:12px; background:#fff; padding:10px; margin-bottom:12px; display:flex; justify-content:space-between; align-items:center; gap:8px; }

    .cover { width:100%; height:150px; object-fit:cover; border-bottom:1px solid var(--line); }
    .preview { padding:10px; background:#fcfdff; flex:1; }
    .kicker { font-size:11px; color:var(--muted); text-transform:uppercase; letter-spacing:.04em; }
    .head { display:grid; grid-template-columns:1fr auto; gap:8px; align-items:center; margin-top:6px; }
    .head h4 { margin:0; font-size:22px; line-height:1.1; }
    .price { font-weight:700; }

    .cta-row { display:flex; flex-wrap:wrap; gap:8px; margin-top:10px; padding:10px; border-top:1px solid var(--line); }
    .btn { border:1px solid var(--line); background:#fff; border-radius:10px; padding:7px 10px; font-size:13px; }
    .btn.primary { background:#111827; color:#fff; border-color:#111827; }

    .dock {
      position: sticky; bottom:10px; margin-top:12px;
      border:1px solid var(--line); background:#fff; border-radius:12px; padding:10px;
      display:flex; justify-content:space-between; gap:8px; align-items:center;
    }
    .summary { border:1px solid var(--line); border-radius:12px; background:#fff; padding:10px; margin-bottom:12px; display:grid; grid-template-columns:1fr auto; gap:10px; align-items:center; }
    .modal-backdrop { position:fixed; inset:0; background:rgba(10,14,24,.6); display:none; z-index:30; padding:14px; }
    .modal-backdrop.open { display:block; }
    .modal { max-width:820px; margin:0 auto; background:#fff; border-radius:14px; border:1px solid var(--line); overflow:hidden; }
    .modal-head { display:flex; justify-content:space-between; align-items:center; padding:12px 14px; border-bottom:1px solid var(--line); }
    .modal-body { padding:12px 14px; }
    .pkg-row { border:1px solid var(--line); border-radius:10px; padding:10px; margin-bottom:8px; background:#fcfdff; display:grid; grid-template-columns:1fr auto; gap:8px; }
    @media (max-width: 960px){ .stack{ grid-template-columns:repeat(2,minmax(0,1fr)); } .bundle-grid{grid-template-columns:1fr;} }
    @media (max-width: 640px){ .stack{ grid-template-columns:1fr; } }
  </style>
</head>
<body>
  <div class="toolbar">
    <label>Shared link (proposal collection):
      <select id="collectionSel"></select>
    </label>
    <label>Variant:
      <select id="variantSel">
        <option value="brand">Branded Villa4you</option>
        <option value="wl">No-logo (white-label locked nav)</option>
      </select>
    </label>
    <span class="hint">Each link opens only its own curated cards. No listing names, ID-only references.</span>
  </div>

  <div class="app">
    <div id="shell" class="shell brand">
      <div class="top">
        <div>
          <div class="logo">Villa<span>4</span>you</div>
          <div class="muted" id="subtitle">Your tailored proposal collection</div>
        </div>
        <div class="badge" id="navState">Secure proposal session</div>
      </div>

      <div class="content">
        <section class="collection-hero">
          <h3 id="collectionTitle">Collection</h3>
          <div class="muted" id="collectionMeta"></div>
          <div class="pill-row" id="pillRow"></div>
        </section>

        <section class="trust-strip" id="trustStrip"></section>
        <section class="summary" id="summary"></section>
        <section class="bundle" id="bundle"></section>
        <section class="proposal-feedback" id="proposalFeedback"></section>
        <section class="stack" id="stack"></section>

        <div class="dock">
          <span class="muted" id="dockText">Events: collection_view ‚Ä¢ card_impression ‚Ä¢ feedback_selected(like|dislike) ‚Ä¢ cta_selected(view_details|reserve|book)</span>
          <button class="btn primary">Continue with preferred option</button>
        </div>
      </div>
    </div>
  </div>

  <div id="packageModal" class="modal-backdrop" aria-hidden="true">
    <div class="modal">
      <div class="modal-head">
        <strong id="packageTitle">Package details</strong>
        <button class="btn" id="closePackage">Close</button>
      </div>
      <div class="modal-body" id="packageBody"></div>
    </div>
  </div>

  <script>
    const collections = [
      {
        link: '/p/PR-26A7/c/COL-8N2K',
        proposalRef: 'PR-26A7',
        collectionRef: 'COL-8N2K',
        guestRequestRef: 'GR-441',
        cards: [
          {label:'Option A', propertyName:'Villa Glarokavos Sea View', shortText:'Sea-view villa ideal for families and groups.', unit:'UNIT-93QX', offer:'OFR-7K2M', price:'‚Ç¨1,940', meta:'7 nights ‚Ä¢ 8 guests ‚Ä¢ Pool ‚Ä¢ 4.6 guest score', image:'https://images.unsplash.com/photo-1499793983690-e29da59ef1c2?q=80&w=1200&auto=format&fit=crop', kind:'Villa', region:'Pefkohori, Halkidiki', bedrooms:4, bathrooms:3},
          {label:'Option B', propertyName:'Blue Coast Maisonette', shortText:'Spacious maisonette with sea-view terraces.', unit:'UNIT-7MPL', offer:'OFR-3R1D', price:'‚Ç¨2,120', meta:'7 nights ‚Ä¢ 8 guests ‚Ä¢ Sea view ‚Ä¢ Flexible check-in', image:'https://images.unsplash.com/photo-1505693416388-ac5ce068fe85?q=80&w=1200&auto=format&fit=crop', kind:'Maisonette', region:'Hanioti, Halkidiki', bedrooms:5, bathrooms:4},
          {label:'Option C', propertyName:'Kallithea Family Apartment', shortText:'Comfort-focused apartment close to key amenities.', unit:'UNIT-X11D', offer:'OFR-9L4P', price:'‚Ç¨2,060', meta:'7 nights ‚Ä¢ 8 guests ‚Ä¢ Family layout ‚Ä¢ Strong value', image:'https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?q=80&w=1200&auto=format&fit=crop', kind:'Apartment', region:'Kallithea, Halkidiki', bedrooms:3, bathrooms:2}
        ],
        bundle: {
          title: 'Combination package (large group)',
          totalPrice: '‚Ç¨2,420',
          items: [
            { type:'Property', ref:'UNIT-93QX', label:'Stay option', propertyName:'Villa Glarokavos Sea View', shortText:'Sea-view villa ideal for families and groups.', detail:'Pefkohori, Halkidiki', price:'‚Ç¨1,940' },
            { type:'Transfer', ref:'TRF-102', label:'Airport transfer', detail:'SKG ‚áÑ Property', price:'‚Ç¨180' },
            { type:'Boat Rental', ref:'BRT-77', label:'Half-day boat', detail:'8 guests capacity', price:'‚Ç¨300' }
          ]
        }
      },
      {
        link: '/p/PR-51D3/c/COL-2T9V',
        proposalRef: 'PR-51D3',
        collectionRef: 'COL-2T9V',
        guestRequestRef: 'GR-602',
        cards: [
          {label:'Option A', propertyName:'Chania Hillside Villa', shortText:'Private hillside villa with quiet surroundings.', unit:'UNIT-K2A1', offer:'OFR-1N8H', price:'‚Ç¨2,680', meta:'10 nights ‚Ä¢ 6 guests ‚Ä¢ Quiet area ‚Ä¢ 4.8 guest score', image:'https://images.unsplash.com/photo-1564013799919-ab600027ffc6?q=80&w=1200&auto=format&fit=crop', kind:'Villa', region:'Chania, Crete', bedrooms:4, bathrooms:3},
          {label:'Option B', propertyName:'Rethymno Sunset Suite', shortText:'Premium suite with sunset terrace views.', unit:'UNIT-M8Q4', offer:'OFR-5U3C', price:'‚Ç¨2,740', meta:'10 nights ‚Ä¢ 6 guests ‚Ä¢ Sunset terrace ‚Ä¢ Late checkout', image:'https://images.unsplash.com/photo-1512918728675-ed5a9ecdebfd?q=80&w=1200&auto=format&fit=crop', kind:'Suite', region:'Rethymno, Crete', bedrooms:3, bathrooms:2}
        ],
        bundle: {
          title: 'Large-group bundle (2‚Äì4 properties)',
          totalPrice: '‚Ç¨9,420',
          items: [
            { type:'Property', ref:'UNIT-K2A1', label:'Property 1', propertyName:'Chania Hillside Villa', shortText:'Private hillside villa with quiet surroundings.', detail:'Chania, Crete', price:'‚Ç¨2,680' },
            { type:'Property', ref:'UNIT-M8Q4', label:'Property 2', propertyName:'Rethymno Sunset Suite', shortText:'Premium suite with sunset terrace views.', detail:'Rethymno, Crete', price:'‚Ç¨2,740' },
            { type:'Property', ref:'UNIT-P4L7', label:'Property 3', propertyName:'Heraklion Urban Villa', shortText:'Modern villa with easy city + beach access.', detail:'Heraklion, Crete', price:'‚Ç¨2,100' },
            { type:'Property', ref:'UNIT-Z9B2', label:'Property 4', propertyName:'Agios Nikolaos Bay House', shortText:'Relaxed stay near the bay, ideal for groups.', detail:'Agios Nikolaos, Crete', price:'‚Ç¨1,900' }
          ]
        }
      }
    ];

    const collectionSel = document.getElementById('collectionSel');
    const variantSel = document.getElementById('variantSel');
    const shell = document.getElementById('shell');
    const params = new URLSearchParams(window.location.search);
    const forcedVariant = params.get('variant');
    const lockControls = params.get('lock') === '1';

    const collectionTitle = document.getElementById('collectionTitle');
    const collectionMeta = document.getElementById('collectionMeta');
    const pillRow = document.getElementById('pillRow');
    const stack = document.getElementById('stack');
    const trustStrip = document.getElementById('trustStrip');
    const bundle = document.getElementById('bundle');
    const summary = document.getElementById('summary');
    const proposalFeedback = document.getElementById('proposalFeedback');
    const subtitle = document.getElementById('subtitle');
    const navState = document.getElementById('navState');
    const dockText = document.getElementById('dockText');
    const packageModal = document.getElementById('packageModal');
    const packageTitle = document.getElementById('packageTitle');
    const packageBody = document.getElementById('packageBody');
    const closePackage = document.getElementById('closePackage');

    collections.forEach((c, i) => {
      const o = document.createElement('option');
      o.value = String(i);
      o.textContent = c.link;
      collectionSel.appendChild(o);
    });

    if (forcedVariant === 'brand' || forcedVariant === 'wl') {
      variantSel.value = forcedVariant;
    }

    const forcedCollection = Number(params.get('col'));
    if (!Number.isNaN(forcedCollection) && forcedCollection >= 0 && forcedCollection < collections.length) {
      collectionSel.value = String(forcedCollection);
    }

    if (lockControls) {
      variantSel.disabled = true;
      collectionSel.disabled = true;
    }

    function renderTrustStrip() {
      trustStrip.innerHTML = `
        <span class="pill">‚úÖ Verified proposal session</span>
        <span class="pill">‚ö° Agent reply in ~10 min</span>
        <span class="pill">üîí Secure booking handoff</span>
        <span class="pill">üõü Flexible cancellation by option</span>
      `;
    }

    function renderSummary(c) {
      summary.innerHTML = `
        <div>
          <div style="font-weight:700">Best matched to your request</div>
          <div class="muted">${c.cards.length} curated options ‚Ä¢ Proposal ${c.proposalRef} ‚Ä¢ Collection ${c.collectionRef}</div>
        </div>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn">üìû Request callback</button>
          <button class="btn open-package">Open package details</button>
          <button class="btn primary">‚úÖ Proceed with selected option</button>
        </div>
      `;
    }

    function renderBundle(bundleData) {
      if (!bundleData) {
        bundle.style.display = 'none';
        return;
      }
      bundle.style.display = 'block';
      bundle.innerHTML = `
        <h4>${bundleData.title}</h4>
        <div class="muted" style="margin-top:6px">Bundle total: ${bundleData.totalPrice}</div>
        <div class="bundle-grid">
          ${bundleData.items.map(i => `<div class="bundle-item"><div class="kicker">${i.type}</div><div style="font-weight:600">${variantSel.value === 'brand' && i.type === 'Property' && i.propertyName ? i.propertyName : i.label}</div>${variantSel.value === 'brand' && i.type === 'Property' && i.shortText ? `<div class="muted" style="margin-top:4px">${i.shortText}</div>` : ''}<div class="muted">${i.ref} ‚Ä¢ ${i.detail}</div><div style="margin-top:4px;font-weight:700">${i.price}</div><div style="margin-top:8px"><button class="btn open-package">View details page</button></div></div>`).join('')}
        </div>
      `;
    }

    function renderProposalFeedback(collectionRef) {
      proposalFeedback.innerHTML = `
        <span class="label">Proposal feedback (whole package):</span>
        <div class="feedback-actions">
          <button class="btn">üëç Like proposal</button>
          <button class="btn">üëé Dislike proposal</button>
          <button class="btn">üìû Call me back</button>
        </div>
      `;
    }

    function openPackageDetails() {
      const c = collections[Number(collectionSel.value || 0)];
      const bundleData = c.bundle;
      if (!bundleData) return;
      packageTitle.textContent = `${bundleData.title} ‚Äî ${c.collectionRef}`;
      packageBody.innerHTML = `
        <div class="muted" style="margin-bottom:8px">Shared link: ${c.link}</div>
        ${bundleData.items.map(i => `<div class="pkg-row"><div><div class="kicker">${i.type}</div><div style="font-weight:600">${variantSel.value === 'brand' && i.type === 'Property' && i.propertyName ? i.propertyName : i.label}</div>${variantSel.value === 'brand' && i.type === 'Property' && i.shortText ? `<div class="muted" style="margin-top:4px">${i.shortText}</div>` : ''}<div class="muted">${i.ref} ‚Ä¢ ${i.detail}</div></div><div style="font-weight:700">${i.price}</div></div>`).join('')}
        <div style="margin-top:8px;padding-top:8px;border-top:1px solid var(--line);display:flex;justify-content:space-between"><strong>Bundle total</strong><strong>${bundleData.totalPrice}</strong></div>
      `;
      packageModal.classList.add('open');
      packageModal.setAttribute('aria-hidden', 'false');
    }

    function closePackageDetails() {
      packageModal.classList.remove('open');
      packageModal.setAttribute('aria-hidden', 'true');
    }

    function renderCards(cards) {
      stack.innerHTML = '';
      cards.forEach(card => {
        const el = document.createElement('article');
        el.className = 'card';
        el.innerHTML = `
          <img class="cover" src="${card.image}" alt="${card.label}" />

          <div class="preview">
            <div class="kicker">Type: ${card.kind} ‚Ä¢ Region: ${card.region}</div>
            <div class="head">
              <h4>${card.label}</h4>
              <div class="price">${card.price}</div>
            </div>
            ${variantSel.value === 'brand' ? `<div class="muted" style="margin-top:6px;font-weight:600;color:#1f2430">${card.propertyName}</div><div class="muted" style="margin-top:4px">${card.shortText || ''}</div>` : ''}
            <div class="muted">Unit ref: ${card.unit} ‚Ä¢ Offer ref: ${card.offer}</div>
            <div class="muted" style="margin-top:6px">${card.meta}</div>
            <div class="muted" style="margin-top:6px">${card.bedrooms} bedrooms ‚Ä¢ ${card.bathrooms} bathrooms</div>
          </div>

          <div class="cta-row">
            <button class="btn">View details</button>
            <button class="btn">Reserve</button>
            <button class="btn primary">Book</button>
          </div>
        `;
        stack.appendChild(el);
      });
    }

    function render() {
      const c = collections[Number(collectionSel.value || 0)];

      collectionTitle.textContent = `Proposal collection ${c.collectionRef}`;
      collectionMeta.textContent = `Proposal ${c.proposalRef} ‚Ä¢ Guest request ${c.guestRequestRef} ‚Ä¢ ${c.cards.length} curated options`;
      subtitle.textContent = `Shared link opens this collection only: ${c.link}`;

      pillRow.innerHTML = `
        <span class="pill">Link scope: single collection</span>
        <span class="pill">No listing names exposed</span>
        <span class="pill">ID-only refs (proposal / unit / offer)</span>
      `;

      dockText.textContent = `Events: collection_view(${c.collectionRef}) ‚Ä¢ proposal_feedback_selected(like|dislike|callback) ‚Ä¢ bundle_feedback_selected ‚Ä¢ card_impression ‚Ä¢ cta_selected(view_details|reserve|book)`;
      renderTrustStrip();
      renderSummary(c);
      renderBundle(c.bundle);
      renderProposalFeedback(c.collectionRef);
      renderCards(c.cards);

      if (variantSel.value === 'wl') {
        shell.classList.add('wl');
        navState.textContent = 'Navigation locked ‚Ä¢ No-logo mode';
      } else {
        shell.classList.remove('wl');
        navState.textContent = 'Secure proposal session';
      }
    }

    collectionSel.addEventListener('change', render);
    variantSel.addEventListener('change', render);
    document.addEventListener('click', (e) => {
      if (e.target.classList && e.target.classList.contains('open-package')) {
        openPackageDetails();
      }
      if (e.target === packageModal) {
        closePackageDetails();
      }
    });
    closePackage.addEventListener('click', closePackageDetails);
    render();
  </script>
</body>
</html>